# 目次機能

note-mcpでは、Markdownから目次（Table of Contents）を自動生成できます。

## 基本的な使い方

### 記法

本文中に`[TOC]`と記述すると、その位置に目次が挿入されます。

```markdown
# 記事タイトル

[TOC]

## はじめに
導入文...

## 本論
本論の内容...

### サブセクション
詳細...

## まとめ
結論...
```

### 生成される目次

目次は記事内の見出し（H2・H3）から自動生成されます。

- **大見出し（H2）**: `##` で記述した見出し
- **小見出し（H3）**: `###` で記述した見出し

> **Note**: H1（`#`）は記事タイトルに使用されるため、目次には含まれません。

## 目次の動作

### 自動更新

目次は見出しの変更に連動して自動更新されます。見出しを追加・編集・削除すると、目次の内容も自動的に反映されます。

### リンク機能

生成された目次の各項目はリンクになっており、クリックすると対応する見出しにジャンプします。

## 使用例

### 技術記事

```markdown
# Pythonでデータ分析

[TOC]

## 環境構築
Pythonのインストール方法...

### 仮想環境の作成
venvを使用して環境を作成...

## データの読み込み
pandasでCSVファイルを読み込む...

## データの可視化
matplotlibでグラフを作成...

## まとめ
この記事で学んだこと...
```

### チュートリアル記事

```markdown
# はじめてのWeb開発

[TOC]

## 準備するもの
必要なツール一覧...

## HTMLの基本
HTMLの構造について...

### タグの種類
よく使うHTMLタグ...

## CSSでデザイン
スタイルの適用方法...

### 色とフォント
色の指定方法...

## 完成
作成したページの確認...
```

## 配置のベストプラクティス

目次は記事の冒頭（導入文の後）に配置することを推奨します。

```markdown
# タイトル

この記事では○○について解説します。

[TOC]

## 最初のセクション
...
```

## 制限事項

- 目次は記事内に1つのみ有効です（複数の`[TOC]`がある場合、最初のもののみ処理されます）
- H1見出しは目次に含まれません
- H4以下の見出しは目次に含まれません
- コードブロック内の`[TOC]`は処理されません

## 他の機能との組み合わせ

目次は他のMarkdown機能と組み合わせて使用できます。

### 数式・ルビとの組み合わせ

```markdown
# $${\LaTeX}$$ 入門

[TOC]

## 数式の基本
インライン数式 $${a^2 + b^2 = c^2}$$ の書き方...

## ｜難読漢字《なんどくかんじ》の読み方
ルビを使った見出しも目次に反映されます...
```

数式やルビを含む見出しも、目次に正しく表示されます。

### 画像との組み合わせ

目次と画像を同一記事内で使用できます。`note_create_from_file`でローカル画像のアップロードと目次生成を同時に行う場合も正しく動作します。

```markdown
# チュートリアル

[TOC]

## セットアップ

以下の画面でインストールを開始します。

![セットアップ画面](./images/setup.png)

## 設定

設定画面の説明...
```

## E2E検証

目次機能はE2Eテストでプレビューページの表示を検証しています。`PreviewValidator.validate_toc()`メソッドはnote.comの`<table-of-contents>`カスタム要素を検出します。

```python
# 目次のレンダリングを検証
validator = PreviewValidator(preview_page)
result = await validator.validate_toc()
assert result.success, "TOC not rendered"
```

TOC + 画像の組み合わせテスト（`test_create_from_toc_and_image_file`）では、目次と画像の両方が正しく表示されることを検証しています。

詳細は[テストドキュメント](../development/testing.md#ファイルベース記事作成テスト)を参照してください。
