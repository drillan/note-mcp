# 数式機能（未サポート）

> **⚠️ 重要**: note-mcpでは数式機能はサポートされていません。これはnote.comプラットフォームの技術的制限によるものです。

## 技術的制限

note.comは数式表示に`<nwc-formula>`というカスタムWeb Componentを使用しています。しかし、note-mcpから数式を含む記事を作成することはできません。

### 制限の詳細

| 経路 | 問題点 |
|------|--------|
| API経由 | note.com APIが`<nwc-formula>`タグをサニタイズ（削除）する |
| ブラウザ経由 | ProseMirrorエディタに数式変換のInputRuleが存在しない |

### 検証結果

2026年1月に実施した検証で、以下の事実が確認されました：

1. **APIサニタイズ**: `markdown_to_html.py`で正しく`<nwc-formula>`タグを生成しても、note.com APIがタグを完全に削除
2. **エディタ制限**: `$formula$`や`$$formula$$`パターンを入力しても、ProseMirrorエディタで変換されずプレーンテキストのまま
3. **UI制限**: エディタの「+」メニュー、キーボードショートカット、スラッシュコマンドに数式挿入機能が存在しない

### 内部レンダリングは正常

note.comに**既に存在する**数式記事では、`<nwc-formula>`要素内でKaTeXが正常にレンダリングされます。問題は**新規作成時の数式挿入方法がない**ことです。

## 代替手段

数式を含む記事を作成する場合は、以下の方法を使用してください：

1. **note.com公式UIを直接使用**: note.comのWebエディタで記事を作成
2. **画像として数式を挿入**: LaTeXで数式を画像化し、通常の画像として埋め込み

## 公式ドキュメントとの矛盾

note.com公式ヘルプには数式記法の説明がありますが、現時点でその機能がどのように有効化されるかは不明です。考えられる可能性：

- プレミアム会員向け機能
- 特定のアプリ（モバイル等）でのみ利用可能
- 機能が廃止または未実装

## 将来の対応

note.com側で以下の変更があれば、note-mcpでの数式サポートが可能になる可能性があります：

1. APIで`<nwc-formula>`タグが許可される
2. ProseMirrorエディタに数式InputRuleが追加される
3. 公式APIで数式挿入エンドポイントが提供される

## 参考リンク

- [note.com公式ヘルプ - 数式記法の使い方](https://www.help-note.com/hc/ja/articles/4410665086873-数式記法の使い方)
- [KaTeX公式ドキュメント](https://katex.org/docs/support_table.html)

## 調査レポート

詳細な技術調査結果は `debug/output/issue101_report.md` を参照してください。
